<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.lowcode.workflow.web.node.data.mapper.NodeDataMapper">

    <update id="saveNodeDatas">
        insert into
            eda_flow_node_data (id, node_name, flow_id, type_id, top, `left`, remark, params, payload, `from`, `to`, version )
        values
            <foreach collection="nodeData" item="n" separator=",">
                (#{n.id}, #{n.nodeName}, #{n.flowId}, #{n.typeId}, #{n.top}, #{n.left}, #{n.remark}, #{n.params}, #{n.payload}, #{n.from}, #{n.to}, #{n.version})
            </foreach>
    </update>


    <delete id="deleteNodeDatas">

        delete from eda_flow_node_data
        where flow_id = #{flowId}

    </delete>


    <select id="findNodeData" resultType="com.lowcode.workflow.web.node.entity.NodeData">
        select * from eda_flow_node_data
        <where>
            flow_id = #{flowId}
            <if test="version != null">and version = #{version}</if>
            <if test="version == null">and version is null</if>
        </where>
    </select>


    <select id="findNodeDataVersion" resultType="com.lowcode.workflow.web.node.entity.NodeData">

        select version from eda_flow_node_data
        where flow_id = #{flowId}
        and version is not null

    </select>
</mapper>